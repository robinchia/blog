---
layout: post
title: "利用SQL注入漏洞登录后台"
categories: 安全
tags: 
 - 安全
 - SQL注入
--- 

# 利用SQL注入漏洞登录后台

### 分享到

* [一键分享]()
* [QQ空间]()
* [新浪微博]()
* [百度搜藏]()
* [人人网]()
* [腾讯微博]()
* [百度相册]()
* [开心网]()
* [腾讯朋友]()
* [百度贴吧]()
* [豆瓣网]()
* [搜狐微博]()
* [百度新首页]()
* [QQ好友]()
* [和讯微博]()
* [更多...]()

[百度分享]()

用户名：  密码：   [新用户注册](http://bbs.php100.com/register.php)

[PHP100三不条约](http://bbs.php100.com/read-htm-tid-693.html) [投稿](http://www.php100.com/cms/com/intome.php?tg)

[![rss]()](http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2012/0210/data/rssmap.html "rss")

[![PHP100中文网-中国第一档PHP资源分享门户]()](http://www.php100.com/)

[网站首页](http://www.php100.com/) | [业界资讯](http://www.php100.com/html/itnews/) | [相关开发资料](http://www.php100.com/html/webkaifa/) | [IT开源报道](http://www.php100.com/html/open-php/) | [相关下载](http://www.php100.com/html/download/) | [视频教程](http://www.php100.com/html/shipinjiaocheng/) | [PHP求职招聘](http://www.php100.com/job.php) | [项目供求](http://www.php100.com/waibao.php) | [资源共享](http://www.php100.com/share.php) | [PHP100中文论坛](http://bbs.php100.com/)

**[Apache&Nginx](http://www.php100.com/html/webkaifa/apache/) | [DIVCSS](http://www.php100.com/html/webkaifa/DIV_CSS/) | [PHP](http://www.php100.com/html/webkaifa/PHP/) | [DB](http://www.php100.com/html/webkaifa/database/) | [JS&JQuery](http://www.php100.com/html/webkaifa/javascript/) | [HTML5](http://www.php100.com/html/webkaifa/HTML5/) | [Android](http://www.php100.com/html/webkaifa/Android/) | [python](http://www.php100.com/html/webkaifa/python/) | [Ajax](http://www.php100.com/html/webkaifa/ajax/) | [XML&JSON](http://www.php100.com/html/webkaifa/xml/) | [Linux](http://www.php100.com/html/webkaifa/Linux/) | [正则](http://www.php100.com/html/webkaifa/zhengzebiaodashi/) |**
[![]()](http://www.chuangen.com/php_training.php)

[首页](http://www.php100.com/) > [开发资料](http://www.php100.com/html/webkaifa/) > [PHP](http://www.php100.com/html/webkaifa/PHP/) > [PHP应用](http://www.php100.com/html/webkaifa/PHP/PHPyingyong/) > 正文

# 利用SQL注入漏洞登录后台

发布时间：2012-02-10 09:42:17   来源：cnblogs.com/hongfei   评论：[0]() 点击：12173 次 【字号：[大]() [中]() [小]()】

[QQ空间]( "分享到QQ空间") [新浪微博]( "分享到新浪微博") [腾讯微博]( "分享到腾讯微博") [人人网]( "分享到人人网") [豆瓣网]( "分享到豆瓣网") [百度空间]( "分享到百度空间") [百度搜藏]( "分享到百度搜藏") [开心网]( "分享到开心网") [复制]( "分享到复制网址") 更多 [8]( "累计分享8次")
题记：工作需要，得好好补习下关于WEB安全方面的相关知识，故撰此文，权当总结，别无它意。读这篇文章，我假设读者有过写SQL语句的经历，或者能看得懂SQL语句　　早在02年，国外关于SQL注入漏洞的技术文章已...

   

题记：工作需要，得好好补习下关于WEB安全方面的相关知识，故撰此文，权当总结，别无它意。读这篇文章，我假设读者有过写SQL语句的经历，或者能看得懂SQL语句

早在02年，国外关于SQL注入漏洞的技术文章已经很多，而国内在05年左右才开始的。

如今，谈SQL注入漏洞是否已是明日黄花，国内大大小小的网站都已经补上漏洞。但，百密必有一疏，入侵是偶然的，但安全绝对不是必然的。

前些天，网上传得沸沸扬扬的“拖库”事件给我们敲响了安全警钟。

在开发网站的时候，出于安全考虑，需要过滤从页面传递过来的字符。通常，用户可以通过以下接口调用数据库的内容：URL地址栏、登陆界面、留言板、搜索框等。这往往给骇客留下了可乘之机。轻则数据遭到泄露，重则服务器被拿下。

现在，很多网站开发人员知其然而不知其所以然，小弟也是，所以赶紧恶补下，总结如学习内容。希望对初学者能够起到抛砖引玉的作用。

**一、SQL注入的步骤**

a) 寻找注入点(如：登录界面、留言板等)

b) 用户自己构造SQL语句(如：’ or 1=1#，后面会讲解)

c) 将sql语句发送给数据库管理系统(DBMS)

d) DBMS接收请求，并将该请求解释成机器代码指令，执行必要的存取操作

e) DBMS接受返回的结果，并处理，返回给用户

因为用户构造了特殊的SQL语句，必定返回特殊的结果(只要你的SQL语句够灵活的话)。

下面，我通过一个实例具体来演示下SQL注入

**二、SQL注入实例详解**(以上测试均假设服务器未开启magic_quote_gpc)

1) 前期准备工作

先来演示通过SQL注入漏洞，登入后台管理员界面

首先，创建一张试验用的数据表：

CREATE TABLE `users` (

`id` int(11) NOT NULL AUTO_INCREMENT,

`username` varchar(64) NOT NULL,

`password` varchar(64) NOT NULL,

`email` varchar(64) NOT NULL,

PRIMARY KEY (`id`),

UNIQUE KEY `username` (`username`)

) ENGINE=MyISAM AUTO_INCREMENT=3 DEFAULT CHARSET=latin1;

添加一条记录用于测试：

INSERT INTO users (username,password,email)

VALUES('MarcoFly',md5('test'),'marcofly@test.com');

接下来，贴上登录界面的源代码：

<html>
<head>
<title>Sql注入演示</title>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
</head>

<body >
<form action="validate.php" method="post">
  <fieldset >
    <legend>Sql注入演示</legend>
    <table>
      <tr>
        <td>用户名：</td>
        <td><input type="text" name="username"></td>
      </tr>
      <tr>
        <td>密&nbsp;&nbsp;码：</td>
        <td><input type="text" name="password"></td>
      </tr>
      <tr>
        <td><input type="submit" value="提交"></td>
        <td><input type="reset" value="重置"></td>
      </tr>
    </table>
  </fieldset>
</form>
</body>
</html>

附上效果图：
![\]()

当用户点击提交按钮的时候，将会把表单数据提交给validate.php页面，validate.php页面用来判断用户输入的用户名和密码有没有都符合要求(这一步至关重要，也往往是SQL漏洞所在)

代码如下：

<html>
<head>
<title>登录验证</title>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
</head>

<body>
<?php

       $conn=@mysql_connect("localhost",'root','') or die("数据库连接失败！");;

       mysql_select_db("injection",$conn) or die("您要选择的数据库不存在");

       $name=$_POST['username'];

       $pwd=$_POST['password'];

       $sql="select * from users where username='$name' and password='$pwd'";

       $query=mysql_query($sql);

       $arr=mysql_fetch_array($query);

       if(is_array($arr)){

              header("Location:manager.php");

       }else{

              echo "您的用户名或密码输入有误，<a href=\"Login.php\">请重新登录！</a>";

       }

?>
</body>
</html>

注意到了没有，我们直接将用户提交过来的数据(用户名和密码)直接拿去执行，并没有实现进行特殊字符过滤，待会你们将明白，这是致命的。

代码分析：如果，用户名和密码都匹配成功的话，将跳转到管理员操作界面(manager.php)，不成功，则给出友好提示信息。

登录成功的界面：
![\]()

登录失败的提示：

![\]()

到这里，前期工作已经做好了，接下来将展开我们的重头戏：SQL注入

2) 构造SQL语句

填好正确的用户名(marcofly)和密码(test)后，点击提交，将会返回给我们“欢迎管理员”的界面。

因为根据我们提交的用户名和密码被合成到SQL查询语句当中之后是这样的：

select * from users where username='marcofly' and password=md5('test')

很明显，用户名和密码都和我们之前给出的一样，肯定能够成功登陆。但是，如果我们输入一个错误的用户名或密码呢?很明显，肯定登入不了吧。恩，正常情况下是如此，但是对于有SQL注入漏洞的网站来说，只要构造个特殊的“字符串”，照样能够成功登录。

比如：在用户名输入框中输入:’ or 1=1#,密码随便输入，这时候的合成后的SQL查询语句为：

select * from users where username='' or 1=1#' and password=md5('')

语义分析：“#”在mysql中是注释符，这样井号后面的内容将被mysql视为注释内容，这样就不会去执行了，换句话说，以下的两句sql语句等价：

select * from users where username='' or 1=1#' and password=md5('')

等价于

select * from users where username='' or 1=1

因为1=1永远是都是成立的，即where子句总是为真，将该sql进一步简化之后，等价于如下select语句：

select * from users

没错，该sql语句的作用是检索users表中的所有字段

小技巧：如果不知道’ or 1=1#中的单引号的作用，可以自己echo 下sql语句，就一目了然了。

看到了吧，一个经构造后的sql语句竟有如此可怕的破坏力，相信你看到这后，开始对sql注入有了一个理性的认识了吧~

没错，SQL注入就是这么容易。但是，要根据实际情况构造灵活的sql语句却不是那么容易的。有了基础之后，自己再去慢慢摸索吧。

有没有想过，如果经由后台登录窗口提交的数据都被管理员过滤掉特殊字符之后呢?这样的话，我们的万能用户名’ or 1=1#就无法使用了。但这并不是说我们就毫无对策，要知道用户和数据库打交道的途径不止这一条。
-

（责任编辑：phpcms）
本文关键字：
* [利用](http://www.php100.com/index.php?m=content&c=tag&catid=21&tag=%C0%FB%D3%C3) [注入](http://www.php100.com/index.php?m=content&c=tag&catid=21&tag=%D7%A2%C8%EB) [漏洞](http://www.php100.com/index.php?m=content&c=tag&catid=21&tag=%C2%A9%B6%B4)

**上一篇：**[JS 调用 Flash 方法](http://www.php100.com/html/webkaifa/javascript/2012/0210/9802.html)
**下一篇：**[几个 PHP 的“魔术常量”](http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2012/0210/9804.html)

* 14 ![]()
震惊
* 14 ![]()
不解
* 3 ![]()
愤怒
* 9 ![]()
杯具
* 18 ![]()
无聊
* 7 ![]()
高兴
* 17 ![]()
支持
* 83 ![]()
超赞

分享到：  [ ]() [ ](http://v.t.sina.com.cn/share/share.php?url=http%3A%2F%2Fwww.php100.com%2Fhtml%2Fwebkaifa%2FPHP%2FPHPyingyong%2F2012%2F0210%2F9803.html&appkey=3172366919&title=%E5%88%A9%E7%94%A8SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E7%99%BB%E5%BD%95%E5%90%8E%E5%8F%B0 "分享到新浪微博") [ ](http://www.douban.com/recommend/?url=http%3A%2F%2Fwww.php100.com%2Fhtml%2Fwebkaifa%2FPHP%2FPHPyingyong%2F2012%2F0210%2F9803.html&title=%E5%88%A9%E7%94%A8SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E7%99%BB%E5%BD%95%E5%90%8E%E5%8F%B0 "分享到豆瓣") [ ](http://share.renren.com/share/buttonshare.do?link=http%3A%2F%2Fwww.php100.com%2Fhtml%2Fwebkaifa%2FPHP%2FPHPyingyong%2F2012%2F0210%2F9803.html&title=%E5%88%A9%E7%94%A8SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E7%99%BB%E5%BD%95%E5%90%8E%E5%8F%B0 "分享到人人") [ ](http://www.kaixin001.com/repaste/share.php?rtitle=%E5%88%A9%E7%94%A8SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E7%99%BB%E5%BD%95%E5%90%8E%E5%8F%B0&rurl=http%3A%2F%2Fwww.php100.com%2Fhtml%2Fwebkaifa%2FPHP%2FPHPyingyong%2F2012%2F0210%2F9803.html&rcontent= "分享到开心网") [ ](http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http%3A%2F%2Fwww.php100.com%2Fhtml%2Fwebkaifa%2FPHP%2FPHPyingyong%2F2012%2F0210%2F9803.html "分享到QQ空间")
最新资讯

* [PHP闭包（Closure）初探](http://www.php100.com/html/itnews/PHPxinwen/2013/0502/13421.html)
* [传 iOS 7 采用扁平化设计：颠覆拟物理念](http://www.php100.com/html/itnews/it/2013/0502/13419.html)
* [创业失败后如何找工作](http://www.php100.com/html/itnews/it/2013/0502/13418.html)
* [程序员的时间都去了哪儿？](http://www.php100.com/html/itnews/it/2013/0502/13416.html)
* [如何组织大型JavaScript应用中的代码？](http://www.php100.com/html/itnews/it/2013/0428/13414.html)
* [互联网 DBA 需要做那些事](http://www.php100.com/html/itnews/it/2013/0428/13413.html)
* [Google 眼镜的核心代码](http://www.php100.com/html/itnews/it/2013/0428/13412.html)
* [谷歌眼镜已被越狱：或削弱谷歌对用户的控制](http://www.php100.com/html/itnews/it/2013/0428/13411.html)

热门内容

* [2013年1月编程语言排行榜](http://www.php100.com/html/itnews/it/2013/0107/11895.html "2013年1月编程语言排行榜")
* [Ubuntu 13.04 正式版发布](http://www.php100.com/html/itnews/it/2013/0427/13409.html "Ubuntu 13.04 正式版发布")
* [百度地图推出卫星地图](http://www.php100.com/html/itnews/it/2011/1118/9311.html "百度地图推出卫星地图")
* [十天学会PHP和MYSQL视频教程篇](http://www.php100.com/html/itnews/PHPxinwen/2009/0408/14.html "十天学会PHP和MYSQL视频教程篇")
* [如何做一个真正牛X 的开源项目](http://www.php100.com/html/itnews/it/2013/0426/13402.html "如何做一个真正牛X 的开源项目")
* [2013年4月编程语言排行榜](http://www.php100.com/html/itnews/it/2013/0408/13335.html "2013年4月编程语言排行榜")
* [使用方正字体侵权索赔过亿](http://www.php100.com/html/itnews/PHPxinwen/2010/0514/4515.html "使用方正字体侵权索赔过亿")
* [如何组织大型JavaScript应用中的代码？](http://www.php100.com/html/itnews/it/2013/0428/13414.html "如何组织大型JavaScript应用中的代码？")

**热点推荐** [更多](http://www.php100.com/html/webkaifa/PHP/PHPyingyong/)

* [教你如何成为PHP高手?](http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2010/0610/4712.html "教你如何成为PHP高手?")
* [PHP导入导出Excel方法](http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2009/0114/309.html "PHP导入导出Excel方法")
* [Redis 的安装配置介绍](http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2011/0406/7873.html "Redis 的安装配置介绍")
* [数据库三范式，轻松理解](http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2009/0830/3245.html "数据库三范式，轻松理解")
* [PHP网站开发方案（开发新人必读）](http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2009/0905/3268.html "PHP网站开发方案（开发新人必读）")
* [PHP面向对象编程专题（附视频教程）](http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2009/0930/3362.html "PHP面向对象编程专题（附视频教程）")
* [php中使用exec,system等函数调用系](http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2010/1101/6727.html "php中使用exec,system等函数调用系统命令")
* [SVN入门及配置使用](http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2010/0830/5346.html "SVN入门及配置使用")
* [php excel类 ，phpExcel使用方法](http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2009/0721/3087.html "php excel类 ，phpExcel使用方法介绍")
* [完美解决failed to open stream](http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2010/0826/5308.html "完美解决failed to open stream: HTTP request failed!")
**广告赞助商** [投放](http://www.php100.com/cms/com/adservice.php)

**最新视频推荐** [更多](http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2012/0210/html/jiaocheng/)

* [［第77讲］新浪微博开放平台 -新](http://www.php100.com/html/shipinjiaocheng/php100-2012/2013/0422/9129.html)
* [［第76讲］微信公共平台 - 平台](http://www.php100.com/html/shipinjiaocheng/php100-2012/2013/0415/9128.html)
* [［第75讲］微信公共平台 - 开放](http://www.php100.com/html/shipinjiaocheng/php100-2012/2013/0407/9127.html)
* [［第74讲］thinkphp 3.1.2 系列](http://www.php100.com/html/shipinjiaocheng/php100-2012/2013/0325/9125.html)
* [［第73讲］thinkphp 3.1.2 系列](http://www.php100.com/html/shipinjiaocheng/php100-2012/2013/0325/9124.html)
* [［第72讲］thinkphp 3.1.2 系列](http://www.php100.com/html/shipinjiaocheng/php100-2012/2013/0325/9123.html)
* [［第71讲］thinkphp 3.1.2 系列](http://www.php100.com/html/shipinjiaocheng/php100-2012/2013/0325/9122.html)
* [［第70讲］thinkphp 3.1.2 系列](http://www.php100.com/html/shipinjiaocheng/php100-2012/2013/0322/9121.html)
* [［第69讲］thinkphp 3.1.2 系列](http://www.php100.com/html/shipinjiaocheng/php100-2012/2013/0322/9120.html)
* [［第68讲］thinkphp 3.1.2 系列](http://www.php100.com/html/shipinjiaocheng/php100-2012/2013/0322/9119.html)
-
[关于我们](http://www.php100.com/cms/com/) | [管理团队](http://www.php100.com/cms/com/buddy.php) | [网站律师]() | [广告服务](http://www.php100.com/cms/com/adservice.php) | [投稿指南](http://www.php100.com/cms/com/intome.php) | [提建议](http://bbs.php100.com/thread-htm-fid-14.html) | [友情链接](http://www.php100.com/plus/flink.php) | [申请加入](http://www.php100.com/plus/flink_add.php) | [网站地图](http://www.php100.com/data/sitemap.html)

Copyright (C) 2007-2011 PHP100.com, All Rights Reserved 版权所有 [上海创恩信息技术有限公司](http://php100.com/go.php?url=http://www.php100.net/). 沪ICP备08100465号
地址:上海徐汇区零陵路585号 爱邦大厦26H座 传真(FAX):021-61190281 电话(Tel):021-61190282
PHP100 Website Powered by PHPCMS. For PHP100. 服务器维护：阿里巴巴-阿里云

[站长统计](http://www.cnzz.com/stat/website.php?web_id=1668579 "站长统计")
